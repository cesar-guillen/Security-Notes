A *Public Key Infrastructure (PKI)* is a group of technologies used to request, create, manage, store, distribute, and revoke digital certificates. 

A primary benefit of PKI is that it allows two people or entities to communicate securely without knowing each other previously.

## Certificate Authority
A *certificate authority (CA)* issues, manages, validates, and revokes certificates. CAs can be large, like public ones, or small, such a single service running on a server within a private network.

If the CA is trusted, all certificates issued by the CA are trusted. This trust is established through the concept of *root of trust*.

## Certificate Trust Models
CAs are trusted by placing a copy of their root certificate in an operating system's trusted root certificate store. The root certificate is the first certificate created by the CA that identifies it. One or more intermediate CAs are also created since the root CA is kept offline for its own security and safekeeping. 

Certificate chaining combines all the certificates from the root CA down to the certificate issued to the end-entities.

![[Pasted image 20251110191743.png]]

## Registration Authority and CSRs
You typically request certificates using a *certificate signing request (CSR)*. The first step is to create the RSA-based private key, which is used to create the public key. You then include the public key in the CSR and the CA will embed the public key in the digital certificate. The private key is not sent to the CA.

## Online Versus Offline CAs
If the CA is online, meaning it is accessible over a network, it’s possible to submit the CSR using an automated process. However, an organization may keep some CAs offline to protect them from attacks. Offline CAs can only accept CSRs manually.

Large organizations typically keep the root CA offline to reduce the risk of compromise. If an intermediate CA becomes compromised, the entire certification path isn’t compromised. The root CA can issue new certificates to replace the compromised certificates. However, if the root CA is compromised, the entire certification path is compromised.

## Certificate Revocation List
CAs revoke certificates for several reasons such as when the private key is compromised or the CA is compromised. The *certificate revocation list (CRL)* includes a list of revoked certificates and is publicly available. An alternative to using a CRL is the Online Certificate Status Protocol (OCSP), which returns answers such as good, revoked, or unknown.

![[Pasted image 20251110192552.png]]

## Validating Certificates
Before clients use a certificate, they must first verify that it is valid with some checks. Browsers will show an error describing the issue.

* **Expired**: Your computer can check if the certificate is expired
* **Certificate not Trusted**: Your computer will check the CA that issued the certificate, if it not trusted, you will be warned.
* **Certificate Revoked**: Clients will request a copy of the CRL, if the certificate is in the list, you will be warned. The client will use a ***cached*** version of the CRL.

Another method of validating a certificate is with the *Online Certificate Status Protocol (OCSP)*, which offers ***real-time*** status on the certificates you query, cached version can be outdated. The issue is that everyone wanted to use it which generated a lot of traffic. 

*Certificate stapling* is an alternative to OCSP. The certificate presenter (such as a web server) appends the certificate with a timestamped digitally signed OCSP response from the CA. This reduces OCSP traffic to and from the CA.

## Certificate Pinning
*Certificate pinning* is a security mechanism designed to prevent attackers from impersonating a website using fraudulent certificates. When configured on a website server, the server responds to client HTTPS requests with an extra header. This extra header includes a list of hashes derived from valid public keys used by the website. It also includes a max-age field specifying how long the client should store and use the data. 

When clients connect to the same website again, they recalculate the hashes and then compare the recalculated hashes with the stored hashes. If the hashes match, it verifies that the client is connected to the same website.

## Key Escrow
