A virtual private network (VPN) is often used for remotes access. Remote access VPNs allow users to access private networks via a public network. 

Access over a public network is a core security concern with VPNs. With more people working from home and connecting to company networks via direct access.

Different tunneling protocols encapsulate and encrypt the traffic to protect the data from unauthorized disclosure. The tunnel prevents anyone from reading the data transferred through it. 

## VPNs and VPN Concentrators
It is possible to create a VPN by enabling services on a server, for example in a Windows Server, you can enable the Direct Access VPN role. If you are only supporting a few VPN clients this is a good solution.

Larger organizations may use a *VPN concentrator*, which is a dedicated device used for VPNs. A VPN concentrator includes all the services needed to create a VPN, including strong encryption and authentication techniques and can support many more clients.

When using a VPN concentrator, you would place it on the [[4. Implementing Network Designs#Screened Subnet|screened subnet]]. The firewall between the internet and the DMZ would forward VPN traffic to the VPN concentrator which would in turn, route all private VPN traffic to the second firewall between the DMZ and the ***intranet***. 

## Remote Access VPN
The VPN client first connects to the Internet using a broadband connection to the ISP. After connecting to the internet, the VPN client can the initiate the VPN connection. 

![[Pasted image 20251027113034.png]]

The VPN server is in the DMZ and reachable through a public IP address. This makes it accessible from any other host on the Internet. A VPN server needs to authenticate clients and a common way to do it is with a [[7. Authentication and Authorization Methods#RADIUS|RADIUS]] server. 

The RADIUS server can contain a database with users but its most commonly used to pass the auth request to an [[5. Comparing Authentication Services#LDAP|LDAP]] server.

##### IPsec as a Tunneling Protocol
*Tunnel Mode* encrypts the entire IP packet, including both the payload and the packet headers, and VPNs commonly use this mode. Packet headers include the IP addresses and MAC addresses. If an attacker intercepts the message they can see the origin IP and the receiver's public IP but not the private IP. 

*Transport Mode* only encrypts the payload and is commonly used in private networks, but not with VPNs. If you are already in a private network there is no need to hide private IP address.

[[2. Protocol Use Cases#^97191e|IPsec]] provides security in two ways:

1. **Authentication**: IPsec includes an Authentication Header (AH) to allow each of the IPsec conversation hosts to authenticate with each other before exchanging data. AH provides [[1. Comparing Identifications and AAA#^a1a5ff|authentication]] and [[1. Core Security Goals#^aed5c3|integrity]] and uses **IP protocol number 51**.
2. **Encryption**: IPsec includes Encapsulating Security Payload (ESP) to encrypt the data and provide confidentiality, authentication and integrity. ESP uses **IP protocol number 50**.

The term **IP Protocol number** is not a typo. It is used so that [[3. Basic Network Infrastructure#Firewalls|firewalls]] can identify these packets with the correct protocol and allow them through. 

##### SSL/TLS as a Tunneling Protocol
Some tunneling protocols use Transport Layer Security (TLS) to secure the VPN channel. As an example, Secure Socket Tunneling Protocol (SSTP) encrypts VPN traffic using TLS over port 443. Using port 443 provides a lot of flexibility for many administrators and rarely requires opening additional firewall ports. It is a useful alternative when the VPN tunnel must go through a device using [[4. Implementing Network Designs#Network Address Translation Gateway|NAT]], and IPsec is not feasible.

##### Split Tunnel Versus Full Tunnel
A *Split tunnel* is used when I am accessing a webpage from my machine with VPN open, the split tunnel will send the connection from my computer without using the tunnel because we are not accessing a private IP.

A *full tunnel* will route our traffic first to the VPN server and then send our request from our private IP.

##### Site-to-Site VPNs
A *site-to-site VPN* includes two VPN servers that act as gateways for two networks separated geographically. For example, an organization can have two locations. One is its headquarters, and the other is a remote office. It can use two VPN servers to act as gateways to connect the two locations together.

![[Pasted image 20251027121226.png]]

##### Always-On VPN
Some VPNs are *always-on VPNs*. They can be used with both site-to-site VPNs and direct access VPNs. When used with a site-to-site VPN, the two VPN gateways maintain the VPN connection. In contrast, some site-to-site VPNs use an on-demand connection. The VPN connection is established when itâ€™s needed, such as when a user connects to a remote system.

##### L2TP as a Tunneling Protocol
*Layer 2 Tunneling Protocol (L2TP)* is a tunneling protocol that is also used for VPNs. The most recent version is L2TPv3. However, none of the L2TP versions provide any encryption, so it is not used by itself for VPN traffic. Instead, data is encrypted with another protocol, such as IPsec, and then passed to L2TP for transport over the VPN.

##### HTML5 VPN Portal
VPN login portal over TLS simple but it uses a lot of resources only use it for one or two people that cant connect using the other methods.

